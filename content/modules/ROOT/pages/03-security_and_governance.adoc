= Security and Governance


== Security & RBAC

* Each user is assigned a dedicated project in *OpenShift Dev Spaces* to host their workspaces.
* Projects can be assigned either automatically by *OpenShift Dev Spaces* or through the use of project templates to allow for more control and policy enforcement, as we will explore in upcoming labs.
* Each user is granted permissions only to their own project, meaning they cannot access other usersâ€™ resources.
* Administrators can set up granular access controls for different groups and users by adding the following configuration to the OpenShift Dev Spaces Custom Resource:

```yaml
 networking:
    auth:
      advancedAuthorization:
        allowUsers:
          - user-a
          - user-b
        denyUsers:
          - user-c
        allowGroups:
          - team-a
          - team-b
        denyGroups:          
          - team-c
```

== Lab 3.1 Setup Granular Access

NOTE: Before proceeding with the lab instructions, you can watch this short video that provides a walkthrough of the steps to setup granular access.

video::03_1_Granular_Access.mp4[]

* In this lab, we will configure granular access to OpenShift Dev Spaces.
* We will create three new users in OpenShift, *Eddie*, *Ella* and *Marc*.
* We will allow access for users *admin*, *eddie* and *ella*, but not for *marc*, by adding the following configuration to our CheCluster Custom Resource Definition:

```yaml
      advancedAuthorization:
        allowUsers:
          - admin
		  - eddie
		  - ella
```     
---

=== Lab 3.1.1 Create new users

* Follow these commands to create a new htpasswd file: 

[source, role="execute"]
----
htpasswd -c -B -b new_users eddie openshift 
---- 

[source, role="execute"]
----
htpasswd -B -b new_users ella openshift
----

[source, role="execute"]
----
htpasswd -B -b new_users marc openshift 
----

---

* In your *OpenShift Console* click on *Administration* on the left menu, then select *Cluster Setting*.
* Then select the *Configuration tab.
* Scroll down to select *OAuth*, then select the *HTPASSWD* option.

image::oauth_httpwd.png[]

03_1_Granular_Access

* Browse and select the file you created.
* Finally click the *Add* button.

image::add_users.png[]

--- 

=== Lab 3.1.2 Add configuration to CheCluster CRD

* Navigate back to the *Installed Operators*, and click on *Red Hat OpenShift Dev Spaces instance Specification* next to *Red HAt OpenShift Dev Spaces* operator.

image::select_provided_api.png[]

* Select the *devspaces* CheCluster.

image::select_checluster.png[]

* Switch to the Yaml view and add the following configuration: 

```yaml
      advancedAuthorization:
        allowUsers:
          - admin
		  - eddie
		  - ella
``` 

* Save your configuration by clicking the *Save* button.
* Feel free to test your configuration using the three new created users.

image::apply_granular_access.png[]

---

== Optimizing Resources

== Enforcing Polices

=== Disable Auto Provisioning 

By default, OpenShift Dev Spaces will provision a unique <username>-devspaces project for each user. Alternatively, the cluster administrator can disable project self-provisioning on the OpenShift level, and turn off automatic namespace provisioning in the CheCluster custom resource:

devEnvironments:
  defaultNamespace:
    autoProvision: false

This setup allows achieving curated access to the Dev Spaces, where cluster administrators control provisioning for each user and can explicitly configure various settings including resource limits and quotas.


* PVC Strategy
* No of running wrokspaces
* Stop Autoprovisioning
* NaaS -> create onboarding project with project template